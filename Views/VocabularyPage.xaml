<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="VocaFlow.Views.VocabularyPage"
             Title="è®°å¿†">

    <Grid RowDefinitions="Auto,Auto,*,Auto" RowSpacing="0">
        
        <!-- é¡¶éƒ¨ï¼šTabæŒ‰é’® + ç¼–è¾‘æŒ‰é’® -->
        <Border Grid.Row="0" 
                Padding="16,12"
                StrokeShape="Rectangle"
                Stroke="Transparent"
                BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource OffBlack}}">
            <Grid ColumnDefinitions="*,Auto">
                <!-- Tab æŒ‰é’®ç»„ -->
                <Border Grid.Column="0"
                        StrokeShape="RoundRectangle 12"
                        Stroke="Transparent"
                        Padding="4"
                        BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceLight}, Dark={StaticResource SurfaceDark}}"
                        HorizontalOptions="Center">
                    <HorizontalStackLayout Spacing="4">
                        <Button x:Name="BtnLyrics" 
                                Text="ðŸ“ æ­Œè¯" 
                                Clicked="OnTabClicked"
                                BackgroundColor="{StaticResource Primary}"
                                TextColor="White"
                                CornerRadius="10"
                                Padding="16,10"
                                FontSize="14"
                                MinimumHeightRequest="40"/>
                        <Button x:Name="BtnJapanese" 
                                Text="ðŸ‡¯ðŸ‡µ æ—¥è¯­" 
                                Clicked="OnTabClicked"
                                BackgroundColor="Transparent"
                                TextColor="{StaticResource Gray600}"
                                CornerRadius="10"
                                Padding="16,10"
                                FontSize="14"
                                MinimumHeightRequest="40"/>
                        <Button x:Name="BtnEnglish" 
                                Text="ðŸ‡¬ðŸ‡§ è‹±è¯­" 
                                Clicked="OnTabClicked"
                                BackgroundColor="Transparent"
                                TextColor="{StaticResource Gray600}"
                                CornerRadius="10"
                                Padding="16,10"
                                FontSize="14"
                                MinimumHeightRequest="40"/>
                    </HorizontalStackLayout>
                </Border>

                <!-- ç¼–è¾‘æŒ‰é’® -->
                <Button x:Name="BtnEdit"
                        Grid.Column="1"
                        Text="ç¼–è¾‘"
                        FontSize="14"
                        BackgroundColor="{AppThemeBinding Light={StaticResource PrimaryLight}, Dark={StaticResource SurfaceDark}}"
                        TextColor="{StaticResource Primary}"
                        CornerRadius="10"
                        Padding="16,10"
                        MinimumHeightRequest="40"
                        VerticalOptions="Center"
                        Clicked="OnEditModeClicked"/>
            </Grid>
        </Border>

        <!-- æœç´¢æ¡†å’Œéšæœºå¤ä¹ æŒ‰é’®ï¼ˆä»…åœ¨è¯æ±‡ Tab æ˜¾ç¤ºï¼‰ -->
        <Border x:Name="VocabToolbar"
                Grid.Row="1"
                IsVisible="False"
                Padding="16,8,16,12"
                StrokeShape="Rectangle"
                Stroke="Transparent"
                BackgroundColor="Transparent">
            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                <Border Grid.Column="0"
                        StrokeShape="RoundRectangle 12"
                        Stroke="Transparent"
                        Padding="4"
                        BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceLight}, Dark={StaticResource SurfaceDark}}">
                    <SearchBar x:Name="VocabSearchBar"
                               Placeholder="æœç´¢è¯æ±‡..."
                               TextChanged="OnVocabSearchTextChanged"
                               SearchButtonPressed="OnVocabSearchButtonPressed"
                               BackgroundColor="Transparent"/>
                </Border>
                <Button x:Name="BtnRandomReview"
                        Grid.Column="1"
                        Text="ðŸŽ² å¤ä¹ "
                        FontSize="14"
                        BackgroundColor="{StaticResource Success}"
                        TextColor="White"
                        CornerRadius="12"
                        Padding="16,10"
                        MinimumHeightRequest="44"
                        VerticalOptions="Center"
                        Clicked="OnRandomReviewClicked"/>
            </Grid>
        </Border>

        <!-- åˆ—è¡¨åŒºåŸŸ -->
        <Grid Grid.Row="2" Padding="12,0">
            <!-- æ­Œè¯åˆ—è¡¨ -->
            <CollectionView x:Name="LyricsList" 
                            IsVisible="True"
                            SelectionMode="None">
                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" 
                                         HorizontalOptions="Center"
                                         Spacing="12"
                                         Padding="40">
                        <Label Text="ðŸ“–" FontSize="56" HorizontalOptions="Center"/>
                        <Label Text="æš‚æ— ä¿å­˜çš„æ­Œè¯" 
                               FontSize="17" 
                               FontAttributes="Bold"
                               TextColor="{StaticResource Gray600}"
                               HorizontalOptions="Center"/>
                        <Label Text="åœ¨æœç´¢é¡µé¢æ‰¾åˆ°å–œæ¬¢çš„æ­Œæ›²å¹¶ä¿å­˜" 
                               FontSize="14" 
                               TextColor="{StaticResource Gray400}"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <SwipeView>
                            <SwipeView.RightItems>
                                <SwipeItems>
                                    <SwipeItem Text="åˆ é™¤" 
                                               BackgroundColor="{StaticResource Danger}" 
                                               Invoked="OnDeleteLyricSwiped"/>
                                </SwipeItems>
                            </SwipeView.RightItems>
                            <Border Margin="4,6" 
                                    Padding="16" 
                                    StrokeShape="RoundRectangle 16"
                                    Stroke="Transparent"
                                    BackgroundColor="{AppThemeBinding Light={StaticResource CardBackground}, Dark={StaticResource CardBackgroundDark}}">
                                <Border.Shadow>
                                    <Shadow Brush="{StaticResource Gray400}"
                                            Offset="0,3"
                                            Radius="10"
                                            Opacity="0.08"/>
                                </Border.Shadow>
                                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="14">
                                    <CheckBox x:Name="LyricCheckBox"
                                              Grid.Column="0"
                                              IsChecked="{Binding IsSelected}"
                                              IsVisible="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.IsEditMode}"
                                              VerticalOptions="Center"/>
                                    <VerticalStackLayout Grid.Column="1" Spacing="6">
                                        <VerticalStackLayout.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnLyricTapped" CommandParameter="{Binding .}"/>
                                        </VerticalStackLayout.GestureRecognizers>
                                        <Label Text="{Binding DisplayText}" 
                                               FontSize="16" 
                                               FontAttributes="Bold"
                                               TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"/>
                                        <Label Text="{Binding CreatedAtText}" 
                                               FontSize="12" 
                                               TextColor="{StaticResource Gray400}"/>
                                    </VerticalStackLayout>
                                </Grid>
                            </Border>
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- æ—¥è¯­è¯æ±‡åˆ—è¡¨ -->
            <CollectionView x:Name="JapaneseList" 
                            IsVisible="False"
                            SelectionMode="None">
                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" 
                                         HorizontalOptions="Center"
                                         Spacing="12"
                                         Padding="40">
                        <Label Text="ðŸ‡¯ðŸ‡µ" FontSize="56" HorizontalOptions="Center"/>
                        <Label Text="æš‚æ— æ—¥è¯­è¯æ±‡" 
                               FontSize="17" 
                               FontAttributes="Bold"
                               TextColor="{StaticResource Gray600}"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <SwipeView>
                            <SwipeView.RightItems>
                                <SwipeItems>
                                    <SwipeItem Text="åˆ é™¤" 
                                               BackgroundColor="{StaticResource Danger}" 
                                               Invoked="OnDeleteVocabSwiped"/>
                                </SwipeItems>
                            </SwipeView.RightItems>
                            <Border Margin="4,6" 
                                    Padding="16" 
                                    StrokeShape="RoundRectangle 16"
                                    Stroke="Transparent"
                                    BackgroundColor="{AppThemeBinding Light={StaticResource CardBackground}, Dark={StaticResource CardBackgroundDark}}">
                                <Border.Shadow>
                                    <Shadow Brush="{StaticResource Gray400}"
                                            Offset="0,3"
                                            Radius="10"
                                            Opacity="0.08"/>
                                </Border.Shadow>
                                <VerticalStackLayout Spacing="4">
                                    <!-- ç®€ç•¥ä¿¡æ¯ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                                        <CheckBox Grid.Column="0"
                                                  IsChecked="{Binding IsSelected}"
                                                  IsVisible="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.IsEditMode}"
                                                  VerticalOptions="Center"/>
                                        <VerticalStackLayout Grid.Column="1" Spacing="4">
                                            <VerticalStackLayout.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnVocabTapped" CommandParameter="{Binding .}"/>
                                            </VerticalStackLayout.GestureRecognizers>
                                            <Label Text="{Binding Word}" 
                                                   FontSize="18" 
                                                   FontAttributes="Bold"/>
                                            <Label Text="{Binding Reading}" 
                                                   FontSize="14" 
                                                   TextColor="{StaticResource Primary}"/>
                                            <Label Text="{Binding Meaning}" 
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"/>
                                            <Label Text="{Binding CreatedAtText}" 
                                                   FontSize="11" 
                                                   TextColor="{StaticResource Gray400}"/>
                                        </VerticalStackLayout>
                                    </Grid>

                                    <!-- è¯¦ç»†ä¿¡æ¯ï¼ˆå±•å¼€æ—¶æ˜¾ç¤ºï¼‰ -->
                                    <Border IsVisible="{Binding IsExpanded}" 
                                            Margin="0,12,0,0"
                                            Padding="14"
                                            StrokeShape="RoundRectangle 12"
                                            Stroke="Transparent"
                                            BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceLight}, Dark={StaticResource SurfaceDark}}">
                                        <VerticalStackLayout Spacing="10">
                                            <!-- ä¸Šä¸‹æ–‡ -->
                                            <VerticalStackLayout IsVisible="{Binding HasContext}" Spacing="4">
                                                <Label Text="ðŸ“Œ ä¸Šä¸‹æ–‡" FontAttributes="Bold" FontSize="12" TextColor="{StaticResource Primary}"/>
                                                <Label Text="{Binding Context}" FontSize="14"/>
                                            </VerticalStackLayout>

                                            <!-- ç”¨æ³• -->
                                            <VerticalStackLayout IsVisible="{Binding HasUsage}" Spacing="4">
                                                <Label Text="ðŸ’¡ ç”¨æ³•" FontAttributes="Bold" FontSize="12" TextColor="{StaticResource Tertiary}"/>
                                                <Label Text="{Binding Usage}" FontSize="14"/>
                                            </VerticalStackLayout>

                                            <!-- ä¾‹å¥ -->
                                            <VerticalStackLayout IsVisible="{Binding HasExamples}" Spacing="4">
                                                <Label Text="ðŸ“ ä¾‹å¥" FontAttributes="Bold" FontSize="12" TextColor="{StaticResource Secondary}"/>
                                                <Label Text="{Binding ExamplesDisplay}" FontSize="14"/>
                                            </VerticalStackLayout>

                                            <!-- ç¼–è¾‘æŒ‰é’® -->
                                            <Button Text="âœï¸ ç¼–è¾‘æ­¤è¯æ±‡"
                                                    FontSize="14"
                                                    Margin="0,6,0,0"
                                                    Clicked="OnEditVocabClicked"
                                                    CommandParameter="{Binding .}"/>
                                        </VerticalStackLayout>
                                    </Border>
                                </VerticalStackLayout>
                            </Border>
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- è‹±è¯­è¯æ±‡åˆ—è¡¨ -->
            <CollectionView x:Name="EnglishList" 
                            IsVisible="False"
                            SelectionMode="None">
                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" 
                                         HorizontalOptions="Center"
                                         Spacing="12"
                                         Padding="40">
                        <Label Text="ðŸ‡¬ðŸ‡§" FontSize="56" HorizontalOptions="Center"/>
                        <Label Text="æš‚æ— è‹±è¯­è¯æ±‡" 
                               FontSize="17" 
                               FontAttributes="Bold"
                               TextColor="{StaticResource Gray600}"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <SwipeView>
                            <SwipeView.RightItems>
                                <SwipeItems>
                                    <SwipeItem Text="åˆ é™¤" 
                                               BackgroundColor="{StaticResource Danger}" 
                                               Invoked="OnDeleteVocabSwiped"/>
                                </SwipeItems>
                            </SwipeView.RightItems>
                            <Border Margin="4,6" 
                                    Padding="16" 
                                    StrokeShape="RoundRectangle 16"
                                    Stroke="Transparent"
                                    BackgroundColor="{AppThemeBinding Light={StaticResource CardBackground}, Dark={StaticResource CardBackgroundDark}}">
                                <Border.Shadow>
                                    <Shadow Brush="{StaticResource Gray400}"
                                            Offset="0,3"
                                            Radius="10"
                                            Opacity="0.08"/>
                                </Border.Shadow>
                                <VerticalStackLayout Spacing="4">
                                    <!-- ç®€ç•¥ä¿¡æ¯ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                                        <CheckBox Grid.Column="0"
                                                  IsChecked="{Binding IsSelected}"
                                                  IsVisible="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.IsEditMode}"
                                                  VerticalOptions="Center"/>
                                        <VerticalStackLayout Grid.Column="1" Spacing="4">
                                            <VerticalStackLayout.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnVocabTapped" CommandParameter="{Binding .}"/>
                                            </VerticalStackLayout.GestureRecognizers>
                                            <Label Text="{Binding Word}" 
                                                   FontSize="18" 
                                                   FontAttributes="Bold"/>
                                            <Label Text="{Binding Reading}" 
                                                   FontSize="14" 
                                                   TextColor="{StaticResource Primary}"/>
                                            <Label Text="{Binding Meaning}" 
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"/>
                                            <Label Text="{Binding CreatedAtText}" 
                                                   FontSize="11" 
                                                   TextColor="{StaticResource Gray400}"/>
                                        </VerticalStackLayout>
                                    </Grid>

                                    <!-- è¯¦ç»†ä¿¡æ¯ï¼ˆå±•å¼€æ—¶æ˜¾ç¤ºï¼‰ -->
                                    <Border IsVisible="{Binding IsExpanded}" 
                                            Margin="0,12,0,0"
                                            Padding="14"
                                            StrokeShape="RoundRectangle 12"
                                            Stroke="Transparent"
                                            BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceLight}, Dark={StaticResource SurfaceDark}}">
                                        <VerticalStackLayout Spacing="10">
                                            <!-- ä¸Šä¸‹æ–‡ -->
                                            <VerticalStackLayout IsVisible="{Binding HasContext}" Spacing="4">
                                                <Label Text="ðŸ“Œ ä¸Šä¸‹æ–‡" FontAttributes="Bold" FontSize="12" TextColor="{StaticResource Primary}"/>
                                                <Label Text="{Binding Context}" FontSize="14"/>
                                            </VerticalStackLayout>

                                            <!-- ç”¨æ³• -->
                                            <VerticalStackLayout IsVisible="{Binding HasUsage}" Spacing="4">
                                                <Label Text="ðŸ’¡ ç”¨æ³•" FontAttributes="Bold" FontSize="12" TextColor="{StaticResource Tertiary}"/>
                                                <Label Text="{Binding Usage}" FontSize="14"/>
                                            </VerticalStackLayout>

                                            <!-- ä¾‹å¥ -->
                                            <VerticalStackLayout IsVisible="{Binding HasExamples}" Spacing="4">
                                                <Label Text="ðŸ“ ä¾‹å¥" FontAttributes="Bold" FontSize="12" TextColor="{StaticResource Secondary}"/>
                                                <Label Text="{Binding ExamplesDisplay}" FontSize="14"/>
                                            </VerticalStackLayout>

                                            <!-- ç¼–è¾‘æŒ‰é’® -->
                                            <Button Text="âœï¸ ç¼–è¾‘æ­¤è¯æ±‡"
                                                    FontSize="14"
                                                    Margin="0,6,0,0"
                                                    Clicked="OnEditVocabClicked"
                                                    CommandParameter="{Binding .}"/>
                                        </VerticalStackLayout>
                                    </Border>
                                </VerticalStackLayout>
                            </Border>
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>

        <!-- åº•éƒ¨åˆ é™¤æŒ‰é’®ï¼ˆç¼–è¾‘æ¨¡å¼æ—¶æ˜¾ç¤ºï¼‰ -->
        <Border x:Name="BtnDeleteSelected"
                Grid.Row="3"
                IsVisible="False"
                Margin="16,8,16,16"
                Padding="0"
                StrokeShape="RoundRectangle 14"
                Stroke="Transparent"
                BackgroundColor="{StaticResource Danger}">
            <Border.Shadow>
                <Shadow Brush="{StaticResource Danger}"
                        Offset="0,4"
                        Radius="12"
                        Opacity="0.3"/>
            </Border.Shadow>
            <Button Text="ðŸ—‘ï¸ åˆ é™¤é€‰ä¸­"
                    BackgroundColor="Transparent"
                    TextColor="White"
                    FontSize="16"
                    Clicked="OnDeleteSelectedClicked"/>
        </Border>
    </Grid>
</ContentPage>
